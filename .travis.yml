---
language: go
sudo: required

services:
    - docker

go:
    - "1.10.3"

go_import_path: gopkg.in/goracle.v2

before_install:
    - docker pull sath89/oracle-12c
    - docker network ls | grep -q ora || docker network create ora
    - export DO_ID=$(docker run -d -p 1521:1521 --network ora -v $(pwd)/oracle/data:/u01/app/oracle sath89/oracle-12c)
    - docker pull sergeymakinen/oracle-instant-client:12.2

install:
    - go get -t .

script:
    - go test -c -covermode=atomic .
    - while ! docker logs "$DO_ID" | grep -F -q 'Database ready to use'; do
        docker logs "$DO_ID" | tail 10
        sleep 10;
      done
    - docker run -ti --network ora --rm
        -e GORACLE_DRV_TEST_USERNAME=system
        -e GORACLE_DRV_TEST_PASSWORD=oracle
        -e GORACLE_DRV_TEST_DB="$DO_ID:1521/xe"
        -v $(pwd)/goracle.v2.test:/goracle.v2.test:ro
        sergeymakinen/oracle-instant-client:12.2
        /goracle.v2.test -test.coverprofile=coverage.txt

after_success:
    - bash <(curl -s https://codecov.io/bash)

# vim: set et:
